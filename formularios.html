<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vereadora Vanessa da Usina · Formulários</title>

  <link rel="icon" href="assets/img/logo.png" type="image/png">
  <link rel="stylesheet" href="style.css" />

  <script src="menu-loader.js" defer></script>

  <!-- Firebase compat (padrão do projeto) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="auth-guard.js"></script>
</head>

<body>
  <div id="authLoading" class="auth-loading">Carregando…</div>

  <main class="container">
    <div class="page-title">
      <h1>Formulários</h1>
      <p>Crie formulários (campos personalizados) e registre respostas vinculadas a uma pessoa cadastrada.</p>
    </div>

    <div class="grid-2">
      <!-- Builder -->
      <section class="glass card">
        <div class="card-title">
          <h2>Criar / editar formulário</h2>
          <span class="badge" id="statusForm">Novo</span>
        </div>

        <form id="formBuilder">
          <label>Título</label>
          <input id="formTitulo" type="text" placeholder="Ex.: Solicitação de apoio" required />

          <label>Descrição</label>
          <textarea id="formDescricao" rows="3" placeholder="Explique rapidamente para que serve..."></textarea>

          <div class="grid-3">
            <div>
              <label>Ativo?</label>
              <select id="formAtivo">
                <option value="sim">Sim</option>
                <option value="nao">Não</option>
              </select>
            </div>
            <div>
              <label>Adicionar campo</label>
              <select id="novoTipoCampo">
                <option value="text">Texto (curto)</option>
                <option value="textarea">Texto (longo)</option>
                <option value="date">Data</option>
                <option value="select">Seleção</option>
              </select>
            </div>
            <div style="display:flex; align-items:flex-end; gap:10px;">
              <button class="btn" type="button" id="btnAddCampo">Adicionar</button>
            </div>
          </div>

          <div class="divider"></div>

          <h2>Campos</h2>
          <div class="report-list" id="listaCampos"></div>

          <div class="actions">
            <button class="btn" type="submit" id="btnSalvarForm">Salvar formulário</button>
            <button class="btn btn-ghost" type="button" id="btnNovoForm">Novo</button>
            <button class="btn btn-danger" type="button" id="btnExcluirForm" style="display:none;">Excluir</button>
          </div>

          <input type="hidden" id="formId" />
        </form>

        <div class="divider"></div>

        <h2>Registrar resposta</h2>
        <div class="hint">Escolha uma pessoa e um formulário ativo. As respostas ficam salvas para consulta.</div>

        <form id="formResposta">
          <div class="grid-2">
            <div>
              <label>Pessoa</label>
              <select id="respPessoa" required></select>
            </div>
            <div>
              <label>Formulário</label>
              <select id="respFormulario" required></select>
            </div>
          </div>

          <div id="respCampos"></div>

          <div class="actions">
            <button class="btn" type="submit">Salvar resposta</button>
            <button class="btn btn-ghost" type="button" id="btnLimparResposta">Limpar</button>
          </div>
        </form>
      </section>

      <!-- List -->
      <section class="glass card">
        <div class="card-title"><h2>Formulários</h2></div>
        <input id="pesquisaForm" type="text" placeholder="Pesquisar formulário..." />
        <div class="divider"></div>

        <div class="list" id="listaFormularios"></div>

        <div class="divider"></div>

        <h2>Respostas recentes</h2>
        <div class="hint">Mostra as últimas 30 respostas (de qualquer formulário).</div>
        <div class="report-list" id="listaRespostas"></div>
      </section>
    </div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <script src="formularios.js"></script>
</body>
</html>
